#include<stdio.h>
#include<math.h>

void campoElectrico( double x, double y, double X[], double Y[], double Q[], int N,double Ex, double Ey);
void distancia (double x, double y, double X[], double Y[], int N,double rmin,double rmax);
void lineaCampo(double x, double y, double X[], double Y[],double Q[], int N);

int main (){
	const double PI=3.141592653589;
	int numCargas, i,j;
	double Q[100], X[100], Y[100], Z[100],n,theta,x0,y0,Ex,Ey,rmin,rmax;
	
	printf("Ingrese el numero de cargas (menor o igual a 100):\n");
	scanf("%i",&numCargas);
	
	printf("Ingrese el valor de cada carga (en Coulombs).\n");	
	for (i=0;i<numCargas;i++){
		printf("Carga %i = ",i+1);
		scanf("%f",&Q[i]);
		printf("\n");
	}
	
	printf("Ingrese la coordenada en x para:\n");
	for (i=0;i<numCargas;i++){
		printf("Carga %i: ",i+1);
		scanf("%f",&X[i]);
		printf("\n");
	}
	
	printf("Ingrese la coordenada en y para:\n");
	for (i=0;i<numCargas;i++){
		printf("Carga %i: ",i+1);
		scanf("%f",&Y[i]);
		printf("\n");
	}
	
	//DIBUJAR LINEAS.
	//Dibujamos 2*n lineas de campo alrededor de cada carga.
	
	n=6;
	for(i=0;i<numCargas;i++){
		for(j=1;j<=2*n;j++){
			theta=(PI/n)*j;
			x0=X[i]+0.1*cos(theta);
			y0=Y[i]+0.1*sin(theta);
			lineaCampo(x0,y0,X,Y,Q,numCargas);
		}
	}
	
	return 0;
}




void campoElectrico( double x, double y, double X[], double Y[], double Q[], int N,double Ex, double Ey){
	int i;
	double yi, xi;
	long double r3;
	
    Ex=0;
    Ey=0;
	
	for(i=0; i<N ; i++){
	xi = x - X[i];	
	yi = y -Y[i];  // Es la distancia entre el punto unicial y la carga en y
	r3 = pow(xi*xi + yi*yi, -1.5); /* Es la parte del denominador de la formula del campo*/ 
	
	Ex = Ex + Q[i]*xi*r3;
	Ey = Ey + Q[i]*yi*r3;		
	}
}


void distancia (double x, double y, double X[], double Y[], int N,double rmin,double rmax) {
    int i;
	double distancia,disMax = 0.0,disMin=1000.0;
	
	for (i=0; i<N; i++){
		
		distancia=sqrt(pow((x-X[i]),2) + pow((y-Y[i]),2));
		
		if (distancia>disMax){
			disMax=distancia;
		}     
		
		if (distancia<disMin){
			disMin=distancia;
		}    
		
	}
	
	rmax=disMax;
	rmin=disMin;
}

void lineaCampo(double x, double y, double X[], double Y[],double Q[], int N){
	const double paso=0.01, max_dist=20.0;
	int i, direccion;
	double x0,y0, rmin, rmax,r,dx,dy,dl,Ex, Ey,E;
	
	for(direccion=-1;direccion<=1;direccion+=2){		
		dl=direccion*paso;
		x0=x;
		y0=y;
		dx=0.0;
		dy=0.0;
		distancia(x0,y0,X,Y,N,rmin,rmax);
	
		
		while(rmin>(2*paso)&&rmax<max_dist){
			
			printf("%15f%15f\n",x0,y0);
			
			campoElectrico(x0+0.5*dx,y0+0.5*dy,X,Y,Q,N,Ex,Ey);
			E=sqrt(Ex*Ex+Ey*Ey);
			if(E<=1.0e-10) break;
			
			dx=(dl*Ex)/E;
			dy=(dl*Ey)/E;
			x0=x0+dx;
			y0=y0+dx;
			distancia(x0,y0,X,Y,N,rmin,rmax);
		}
	}
}
